name: Bible In A Year â€“ Groups Logger

on:
  schedule:
    # ~2:00 PM Los Angeles time (cover PDT/PST)
    - cron: '0 21 * * *'   # 2:00 PM PDT (UTC-7)
    - cron: '0 22 * * *'   # 2:00 PM PST (UTC-8)

    # ~7:00 PM Los Angeles time
    - cron: '0 2 * * *'    # 7:00 PM PDT (02:00 UTC next day)
    - cron: '0 3 * * *'    # 7:00 PM PST (03:00 UTC next day)

    # ~11:20 PM Los Angeles time
    - cron: '20 6 * * *'   # 11:20 PM PDT (06:20 UTC next day)
    - cron: '20 7 * * *'   # 11:20 PM PST (07:20 UTC next day)

  workflow_dispatch:

jobs:
  run-bot:
    runs-on: ubuntu-latest

    env:
      DISCORD_TOKEN: ${{ secrets.DISCORD_TOKEN }}
      GOOGLE_CREDS_JSON: ${{ secrets.GOOGLE_CREDS_JSON }}
      SHEET_NAME: ${{ secrets.SHEET_NAME }}

      TRACK_CHANNEL_ID: ${{ secrets.TRACK_CHANNEL_ID }}
      REQUIRE_AUTHOR_ID: ${{ secrets.REQUIRE_AUTHOR_ID }}
      TITLE_MATCH: ${{ secrets.TITLE_MATCH }}

      TAB_INDIVIDUALS: Individuals
      TAB_GROUPS: Groups
      TAB_MAPPING: Member Mapping

      DRY_RUN: "0"
      RUN_ONCE: "0"

    steps:
      - name: Checkout repo
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.11"

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt

      - name: Run Discord bot
        run: python main.py
        env:
          # Secrets (already correct)
          DISCORD_TOKEN: ${{ secrets.DISCORD_TOKEN }}
          GOOGLE_CREDS_JSON: ${{ secrets.GOOGLE_CREDS_JSON }}

          # Repository variables (THIS WAS MISSING)
          SHEET_NAME: ${{ vars.SHEET_NAME }}
          TRACK_CHANNEL_ID: ${{ vars.TRACK_CHANNEL_ID }}
          REQUIRE_AUTHOR_ID: ${{ vars.REQUIRE_AUTHOR_ID }}
          TITLE_MATCH: ${{ vars.TITLE_MATCH }}
          TRACK_EMOJI: ${{ vars.TRACK_EMOJI }}
          SPREADSHEET_ID: ${{ vars.SPREADSHEET_ID }}

          TAB_INDIVIDUALS: ${{ vars.TAB_INDIVIDUALS }}
          TAB_GROUPS: ${{ vars.TAB_GROUPS }}
          TAB_MAPPING: ${{ vars.TAB_MAPPING }}

          STATUS_CHANNEL_ID: ${{ vars.STATUS_CHANNEL_ID }}


          DRY_RUN: ${{ vars.DRY_RUN }}
          RUN_ONCE: ${{ vars.RUN_ONCE }}

